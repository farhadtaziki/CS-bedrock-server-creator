<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CS Bedrock Server Creator — Demo</title>
  <style>
    :root{
      --bg:#071024;--card:#0b1220;--accent:#1ea34a;--muted:#94a3b8;--glass:rgba(255,255,255,0.03);
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,#061223 0%,#041526 100%);color:#e6eef8;min-height:100vh}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .btn{background:var(--accent);color:#022;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .btn.danger{background:var(--danger);color:#111}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:18px}
    aside{background:var(--card);padding:16px;border-radius:12px;min-height:420px}
    main{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;min-height:420px}
    .card{background:var(--glass);padding:12px;border-radius:10px;margin-bottom:12px}
    .server-list{display:flex;flex-direction:column;gap:10px}
    .server-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .server-meta{display:flex;flex-direction:column}
    .server-name{font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    .topbar{display:flex;align-items:center;gap:8px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    textarea.small{height:120px}
    .row{display:flex;gap:10px}
    .row .col{flex:1}
    .hint{font-size:12px;color:var(--muted)}
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;z-index:40}
    .modal{width:720px;background:linear-gradient(180deg,#071a28,#03111a);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    .npc-list{display:flex;flex-direction:column;gap:8px}
    .npc{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:space-between}
    .flex{display:flex;gap:8px;align-items:center}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    .uploader{display:flex;gap:8px;align-items:center}
    .texture-thumb{width:48px;height:48px;border-radius:8px;background:#08121a;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .texture-thumb img{width:100%;height:100%;object-fit:cover}
    .top-info{display:flex;gap:12px;align-items:center}
    @media(max-width:880px){.layout{grid-template-columns:1fr}aside{order:2}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="top-info">
        <h1>CS Bedrock Server Creator</h1>
        <div class="small" id="site-note">Demo — local only</div>
      </div>
      <div class="topbar">
        <div id="user-display" class="small"></div>
        <button id="auth-btn" class="btn">Log In / Sign Up</button>
      </div>
    </header>

    <div class="layout">
      <aside>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Your servers</div>
              <div id="server-count" style="font-weight:700">0</div>
            </div>
            <button id="create-top" class="btn">Create</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Quick actions</div>
          <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px">
            <button id="import-btn" class="btn ghost">Import</button>
            <button id="export-btn" class="btn ghost">Export</button>
            <button id="clear-all" class="btn ghost">Clear All Demo Data</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Help</div>
          <div style="margin-top:8px">
            <div class="small">Open-source demo. To host real servers you'll need a backend & VPS.</div>
          </div>
        </div>
      </aside>

      <main>
        <div id="main-area">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Dashboard</div>
                <div class="small">Manage and configure your Bedrock servers</div>
              </div>
              <div class="small">Local demo • data saved in browser</div>
            </div>
          </div>

          <div id="servers" class="server-list"></div>

          <div id="server-panel" style="display:none" class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div id="panel-name" style="font-weight:700"></div>
                <div id="panel-sub" class="small"></div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <button id="copy-address" class="btn ghost">Copy Address</button>
                <button id="start-stop" class="btn">Start</button>
              </div>
            </div>

            <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)" />

            <div style="display:grid;grid-template-columns:1fr 320px;gap:12px">
              <div>
                <div style="font-weight:700;margin-bottom:8px">Server Settings & Editors</div>

                <div class="field">
                  <label>Version</label>
                  <select id="panel-version"></select>
                </div>

                <div class="field">
                  <label>Server Description</label>
                  <input id="panel-desc" placeholder="Short description" />
                </div>

                <div style="margin-top:10px">
                  <div style="font-weight:700;margin-bottom:6px">Texture Pack</div>
                  <div class="uploader">
                    <div class="texture-thumb" id="texture-thumb"><span class="small">No</span></div>
                    <div style="flex:1">
                      <input id="panel-texture-url" placeholder="Texture URL (or leave blank)" />
                      <div style="display:flex;gap:8px;margin-top:6px">
                        <input id="texture-file" type="file" accept="image/*" />
                        <button id="apply-texture" class="btn ghost">Apply Upload</button>
                        <button id="remove-texture" class="btn ghost">Remove</button>
                      </div>
                      <div class="hint">Upload stores image as local dataURL (demo)</div>
                    </div>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <div style="font-weight:700;margin-bottom:6px">NPC GUI Editor</div>
                  <div class="npc-list" id="npc-list"></div>
                  <div style="display:flex;gap:8px;margin-top:8px">
                    <input id="npc-name" placeholder="NPC name" />
                    <button id="add-npc" class="btn ghost">Add NPC</button>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <div style="font-weight:700;margin-bottom:6px">Mods (one JSON descriptor per line)</div>
                  <textarea id="mods-area" class="small" placeholder='{"id":"mod1","desc":"..."}'></textarea>
                  <div style="display:flex;gap:8px;margin-top:8px">
                    <button id="save-mods" class="btn">Save Mods</button>
                    <button id="clear-mods" class="btn ghost">Clear Mods</button>
                  </div>
                </div>

                <div style="margin-top:12px">
                  <div style="font-weight:700;margin-bottom:6px">Game Rules & Gamemode</div>
                  <div class="row">
                    <div class="col field"><label>Gamemode</label><select id="gamemode"><option>survival</option><option>creative</option><option>adventure</option></select></div>
                    <div class="col field"><label>Keep Inventory</label><select id="keepinv"><option value="false">false</option><option value="true">true</option></select></div>
                  </div>
                  <div style="margin-top:8px"><button id="save-settings" class="btn">Save Settings</button></div>
                </div>

              </div>

              <div>
                <div style="font-weight:700;margin-bottom:8px">Preview / Logs</div>
                <div id="preview" style="height:260px;overflow:auto;padding:8px;border-radius:8px;background:rgba(255,255,255,0.015)"></div>

                <div style="margin-top:12px">
                  <div style="font-weight:700;margin-bottom:6px">Danger Zone</div>
                  <button id="delete-server" class="btn danger">Delete Server</button>
                </div>
              </div>
            </div>

          </div>

        </div>
        <footer>Demo only: no real hosting. To make live servers you'll need a backend and hosting.</footer>
      </main>
    </div>
  </div>

  <!-- modal -->
  <div id="modal" class="modal-backdrop"><div class="modal"><div id="modal-body"></div></div></div>

  <script>
/* -------------------------
   Demo app — all local only
   ------------------------- */
const VERSIONS = ['1.19.70','1.20.0','1.20.10','1.21.0','1.22.0']
const authBtn = document.getElementById('auth-btn')
const userDisplay = document.getElementById('user-display')
const modal = document.getElementById('modal')
const modalBody = document.getElementById('modal-body')
const createTop = document.getElementById('create-top')
const serversEl = document.getElementById('servers')
const serverCount = document.getElementById('server-count')
const serverPanel = document.getElementById('server-panel')
const panelName = document.getElementById('panel-name')
const panelSub = document.getElementById('panel-sub')
const panelVersion = document.getElementById('panel-version')
const panelDesc = document.getElementById('panel-desc')
const panelTextureUrl = document.getElementById('panel-texture-url')
const textureFile = document.getElementById('texture-file')
const applyTextureBtn = document.getElementById('apply-texture')
const removeTextureBtn = document.getElementById('remove-texture')
const textureThumb = document.getElementById('texture-thumb')
const npcListEl = document.getElementById('npc-list')
const addNpcBtn = document.getElementById('add-npc')
const npcNameInput = document.getElementById('npc-name')
const modsArea = document.getElementById('mods-area')
const saveModsBtn = document.getElementById('save-mods')
const clearModsBtn = document.getElementById('clear-mods')
const gamemodeEl = document.getElementById('gamemode')
const keepInvEl = document.getElementById('keepinv')
const previewEl = document.getElementById('preview')
const deleteServerBtn = document.getElementById('delete-server')
const startStopBtn = document.getElementById('start-stop')
const copyAddressBtn = document.getElementById('copy-address')
const importBtn = document.getElementById('import-btn')
const exportBtn = document.getElementById('export-btn')
const clearAllBtn = document.getElementById('clear-all')

let state = { user: null, servers: [], selected: null }

/* state persistence */
function loadState(){
  const raw = localStorage.getItem('cs_bedrock_demo_v1')
  if(raw){ try{ state = JSON.parse(raw) }catch(e){ state = { user:null, servers:[], selected:null } } }
  renderAuth()
  renderServers()
}
function saveState(){ localStorage.setItem('cs_bedrock_demo_v1', JSON.stringify(state)) }

/* auth */
function renderAuth(){
  if(state.user && state.user.username){ userDisplay.textContent = state.user.username; authBtn.textContent = 'Log out' }
  else { userDisplay.textContent = ''; authBtn.textContent = 'Log In / Sign Up' }
}
authBtn.addEventListener('click', ()=>{
  if(state.user){ state.user = null; saveState(); renderAuth(); renderServers(); hidePanel(); return }
  showModalAuth()
})
function showModalAuth(){
  modalBody.innerHTML = `
    <h2>Sign in / Sign up</h2>
    <div class="auth">
      <input id="auth-user" placeholder="username" />
      <input id="auth-pass" placeholder="password" type="password" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="do-login" class="btn">Log in</button>
        <button id="do-signup" class="btn ghost">Sign up</button>
      </div>
      <div class="small" style="margin-top:8px">This demo stores accounts locally (in your browser). Username must be unique.</div>
    </div>
  `
  modal.style.display = 'flex'
  document.getElementById('do-login').onclick = ()=>{
    const u = document.getElementById('auth-user').value.trim()
    const p = document.getElementById('auth-pass').value
    if(!u||!p) return alert('Enter username & password')
    const users = JSON.parse(localStorage.getItem('cs_users')||'[]')
    const found = users.find(x=>x.username===u && x.pass===p)
    if(found){ state.user = { username: u }; saveState(); modal.style.display='none'; renderAuth(); renderServers() }
    else alert('Invalid credentials')
  }
  document.getElementById('do-signup').onclick = ()=>{
    const u = document.getElementById('auth-user').value.trim()
    const p = document.getElementById('auth-pass').value
    if(!u||!p) return alert('Enter username & password')
    const users = JSON.parse(localStorage.getItem('cs_users')||'[]')
    if(users.find(x=>x.username===u)) return alert('Username taken')
    users.push({ username: u, pass: p })
    localStorage.setItem('cs_users', JSON.stringify(users))
    state.user = { username: u }; saveState(); modal.style.display='none'; renderAuth(); renderServers()
  }
}

/* create server modal */
createTop.addEventListener('click', ()=>{
  if(!state.user) { showModalAuth(); return }
  showModalCreate()
})
function showModalCreate(){
  modalBody.innerHTML = `
    <h2>Create a new server</h2>
    <div class="field">
      <label>Version</label>
      <select id="new-version">${VERSIONS.map(v=>`<option>${v}</option>`).join('')}</select>
    </div>
    <div class="field">
      <label>Server name (no spaces)</label>
      <input id="new-name" placeholder="my_server_01" />
      <div class="hint">Address preview: <b id="address-preview">example.user.csservercreator.com</b></div>
    </div>
    <div class="field">
      <label>Short description (optional)</label>
      <input id="new-desc" placeholder="A short server description" />
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="create-server-btn" class="btn">Create</button>
      <button id="cancel-create" class="btn ghost">Cancel</button>
    </div>
  `
  modal.style.display = 'flex'
  const nameInput = document.getElementById('new-name')
  const addrPreview = document.getElementById('address-preview')
  const descInput = document.getElementById('new-desc')
  function updateAddr(){ const clean = (nameInput.value.trim()||'example').replace(/\s+/g,'_').toLowerCase(); const user = state.user?.username?.toLowerCase()||'user'; addrPreview.textContent = `${clean}.${user}.csservercreator.com` }
  nameInput.oninput = updateAddr; updateAddr()
  document.getElementById('cancel-create').onclick = ()=> modal.style.display='none'
  document.getElementById('create-server-btn').onclick = ()=>{
    const name = nameInput.value.trim().replace(/\s+/g,'_')
    const version = document.getElementById('new-version').value
    const desc = descInput.value.trim()
    if(!name.match(/^[A-Za-z0-9_\-]+$/)){ return alert('Invalid name (use letters, numbers, _ or -)') }
    const id = Math.random().toString(36).slice(2,9)
    const port = 19132 + Math.floor(Math.random()*10000)
    const address = `${name.toLowerCase()}.${state.user.username.toLowerCase()}.csservercreator.com:${port}`
    const server = {
      id, name, owner: state.user.username, version, desc, texture:'', textureData:null,
      npcs:[], mods:[], port, address, created: Date.now(), running:false, gamerules:{ keepInventory:false }, gamemode:'survival', logs:[]
    }
    state.servers.push(server); saveState(); modal.style.display='none'; renderServers(); openPanel(id)
  }
}

/* modal click to close */
modal.onclick = (e)=> { if(e.target === modal) modal.style.display='none' }

/* render servers */
function renderServers(){
  const list = state.servers.filter(s => state.user && s.owner === state.user.username)
  serversEl.innerHTML = ''
  serverCount.textContent = list.length
  if(list.length === 0){ serversEl.innerHTML = '<div class="card small">No servers yet — create one!</div>'; return }
  list.forEach(s=>{
    const div = document.createElement('div'); div.className = 'server-item'
    div.innerHTML = `
      <div class="server-meta">
        <div class="server-name">${s.name}</div>
        <div class="small">${s.version} · ${s.running?'<span style="color:#6ee7b7">running</span>':'stopped'}</div>
      </div>
      <div class="flex">
        <button class="btn ghost" data-id="${s.id}" data-action="open">Open</button>
        <button class="btn ghost" data-id="${s.id}" data-action="copy">Copy</button>
        <button class="btn ghost" data-id="${s.id}" data-action="export">Export</button>
      </div>`
    serversEl.appendChild(div)
  })
  serversEl.querySelectorAll('button').forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.getAttribute('data-id'); const act = btn.getAttribute('data-action')
      if(act === 'open') openPanel(id)
      if(act === 'copy'){ const s = state.servers.find(x=>x.id===id); navigator.clipboard?.writeText(s.address); alert('Address copied') }
      if(act === 'export'){ const s = state.servers.find(x=>x.id===id); const blob = new Blob([JSON.stringify(s,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`server_${s.name}.json`; a.click(); URL.revokeObjectURL(url) }
    }
  })
}

/* open panel */
function openPanel(id){
  const s = state.servers.find(x=>x.id===id); if(!s) return
  state.selected = id; saveState()
  panelName.textContent = s.name
  panelSub.innerHTML = `Owner: ${s.owner}<br>Created: ${new Date(s.created).toLocaleString()}<br>Address: <b>${s.address}</b><br>Port: ${s.port}`
  // version select
  panelVersion.innerHTML = VERSIONS.map(v=>`<option value="${v}" ${v===s.version?'selected':''}>${v}</option>`).join('')
  panelDesc.value = s.desc || ''
  // texture
  if(s.textureData){ textureThumb.innerHTML = `<img src="${s.textureData}" alt="texture">` } else textureThumb.innerHTML = '<span class="small">No</span>'
  panelTextureUrl.value = s.texture || ''
  // npc list
  renderNpcList(s)
  // mods
  modsArea.value = (s.mods||[]).map(m=>JSON.stringify(m)).join('\n')
  // gamerules
  gamemodeEl.value = s.gamemode || 'survival'
  keepInvEl.value = s.gamerules?.keepInventory ? 'true' : 'false'
  previewEl.innerHTML = s.logs.slice(-40).map(l=>`<div class="small">${l}</div>`).join('')
  startStopBtn.textContent = s.running ? 'Stop' : 'Start'
  serverPanel.style.display = 'block'
}

/* hide panel */
function hidePanel(){ serverPanel.style.display='none'; state.selected = null }

/* NPC list functions */
function renderNpcList(s){
  npcListEl.innerHTML = ''
  s.npcs.forEach(n=>{
    const div = document.createElement('div'); div.className = 'npc'
    div.innerHTML = `<div><strong>${n.name}</strong><div class="small">${n.buttons.map(b=>b.label).join(', ') || 'no buttons'}</div></div>
      <div style="display:flex;gap:6px">
        <button class="btn ghost" data-act="edit" data-id="${n.id}">Edit</button>
        <button class="btn ghost" data-act="del" data-id="${n.id}">Delete</button>
      </div>`
    npcListEl.appendChild(div)
  })
  npcListEl.querySelectorAll('button').forEach(b=>{
    b.onclick = ()=>{
      const id = b.getAttribute('data-id'); const act = b.getAttribute('data-act')
      const s = state.servers.find(x=>x.id === state.selected)
      const idx = s.npcs.findIndex(x=>x.id===id)
      if(act === 'del'){ s.npcs.splice(idx,1); s.logs.push(`[${new Date().toLocaleTimeString()}] NPC deleted`); saveState(); renderNpcList(s); openPanel(s.id); return }
      if(act === 'edit'){
        // show modal for editing npc
        const npc = s.npcs[idx]
        modalBody.innerHTML = `
          <h3>Edit NPC</h3>
          <div class="field"><label>Name</label><input id="npc-edit-name" value="${npc.name}" /></div>
          <div class="field"><label>Buttons (label::action, one per line)</label><textarea id="npc-edit-btns">${npc.buttons.map(b=>b.label+'::'+(b.action||'')).join('\\n')}</textarea></div>
          <div style="display:flex;gap:8px;margin-top:8px"><button id="save-npc" class="btn">Save</button><button id="cancel-npc" class="btn ghost">Cancel</button></div>
        `
        modal.style.display = 'flex'
        document.getElementById('cancel-npc').onclick = ()=> modal.style.display='none'
        document.getElementById('save-npc').onclick = ()=>{
          const nn = document.getElementById('npc-edit-name').value.trim()||'NPC'
          const lines = document.getElementById('npc-edit-btns').value.split('\n').map(l=>l.trim()).filter(Boolean)
          npc.name = nn
          npc.buttons = lines.map(line=>{
            const parts = line.split('::')
            return { label: parts[0]||'btn', action: parts[1]||'' }
          })
          s.logs.push(`[${new Date().toLocaleTimeString()}] NPC ${nn} edited`)
          saveState(); modal.style.display='none'; renderNpcList(s); openPanel(s.id)
        }
      }
    }
  })
}

/* add NPC */
addNpcBtn.onclick = ()=>{
  const name = npcNameInput.value.trim() || 'NPC'
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return alert('Open a server first')
  s.npcs.push({ id: Math.random().toString(36).slice(2,9), name, buttons: [{label:'Hello', action:'/say hi'}] })
  s.logs.push(`[${new Date().toLocaleTimeString()}] NPC ${name} added`)
  npcNameInput.value=''; saveState(); renderNpcList(s); openPanel(s.id)
}

/* texture upload handling (store as dataURL) */
applyTextureBtn.onclick = ()=>{
  const f = textureFile.files[0]; if(!f) return alert('Choose an image file first')
  const reader = new FileReader()
  reader.onload = (ev)=>{
    const data = ev.target.result
    const s = state.servers.find(x=>x.id===state.selected); if(!s) return
    s.texture = panelTextureUrl.value || ''
    s.textureData = data
    s.logs.push(`[${new Date().toLocaleTimeString()}] Texture uploaded`)
    saveState(); openPanel(s.id)
  }
  reader.readAsDataURL(f)
}
removeTextureBtn.onclick = ()=>{
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return
  s.texture = ''; s.textureData = null; s.logs.push(`[${new Date().toLocaleTimeString()}] Texture removed`); saveState(); openPanel(s.id)
}

/* save mods */
saveModsBtn.onclick = ()=>{
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return
  const lines = modsArea.value.split('\n').map(l=>l.trim()).filter(Boolean)
  const mods = []
  for(const l of lines){
    try{ mods.push(JSON.parse(l)) } catch(e){ return alert('Invalid JSON in mods (fix it)') }
  }
  s.mods = mods; s.logs.push(`[${new Date().toLocaleTimeString()}] Mods updated (${mods.length})`); saveState(); openPanel(s.id); alert('Mods saved')
}
clearModsBtn.onclick = ()=>{
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return
  s.mods = []; modsArea.value=''; s.logs.push(`[${new Date().toLocaleTimeString()}] Mods cleared`); saveState(); openPanel(s.id)
}

/* save settings */
document.getElementById('save-settings').onclick = ()=>{
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return
  s.gamemode = gamemodeEl.value; s.gamerules.keepInventory = keepInvEl.value === 'true'
  s.version = panelVersion.value; s.desc = panelDesc.value.trim(); s.texture = panelTextureUrl.value.trim() || s.texture
  s.logs.push(`[${new Date().toLocaleTimeString()}] Settings updated`); saveState(); openPanel(s.id); alert('Settings saved')
}

/* start/stop */
startStopBtn.onclick = ()=>{
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return
  s.running = !s.running; s.logs.push(`[${new Date().toLocaleTimeString()}] Server ${s.running ? 'started' : 'stopped'}`); saveState(); openPanel(s.id)
}

/* copy address */
copyAddressBtn.onclick = ()=>{
  const s = state.servers.find(x=>x.id===state.selected); if(!s) return
  navigator.clipboard?.writeText(s.address); alert('Address copied to clipboard')
}

/* delete server */
deleteServerBtn.onclick = ()=>{
  if(!confirm('Delete this server?')) return
  const idx = state.servers.findIndex(x=>x.id===state.selected); if(idx===-1) return
  state.servers.splice(idx,1); state.selected=null; saveState(); renderServers(); hidePanel()
}

/* import/export / clear all */
exportBtn.onclick = ()=>{
  const dump = { users: JSON.parse(localStorage.getItem('cs_users')||'[]'), state }
  const blob = new Blob([JSON.stringify(dump,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob)
  const a=document.createElement('a'); a.href=url; a.download='cs_bedrock_backup.json'; a.click(); URL.revokeObjectURL(url)
}
importBtn.onclick = ()=>{
  const inp = document.createElement('input'); inp.type='file'; inp.accept='.json'
  inp.onchange = e=>{
    const f = e.target.files[0]; if(!f) return
    const r = new FileReader(); r.onload = ev=>{
      try{
        const data = JSON.parse(ev.target.result)
        if(data.users) localStorage.setItem('cs_users', JSON.stringify(data.users))
        if(data.state) { state = data.state; saveState(); renderServers(); renderAuth(); hidePanel() }
        alert('Import complete')
      } catch(err){ alert('Invalid import file') }
    }; r.readAsText(f)
  }; inp.click()
}
clearAllBtn.onclick = ()=>{
  if(!confirm('Clear all demo data from this browser? This cannot be undone.')) return
  localStorage.removeItem('cs_users'); localStorage.removeItem('cs_bedrock_demo_v1'); state = { user:null, servers:[], selected:null }; renderAuth(); renderServers(); hidePanel(); alert('Cleared')
}

/* On load */
loadState()
  </script>
</body>
</html>
